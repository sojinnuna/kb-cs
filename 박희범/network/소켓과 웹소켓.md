## 소켓과 웹소켓

## 소켓
- 소켓이란?
  
    컴퓨터 네트워크를 경유하는 프로세스 간 통신의 종착점입니다.

    application layer와 transport layer의 메시지 송수신 인터페이스입니다.

   ![socket](https://www.labs.cs.uregina.ca/330/Sockets/server-client.png)

    소켓은 UNIX 운영체제에서 파일로 간주됩니다.
    > OS수준에서 파일이란 크게 2개로 나뉩니다. 
    > 1. 2차 메모리에 저장된 단위 데이터 덩어리를 의미하는 파일 
    > 2. 장치에 대한 추상화된 인터페이스를 제공하는 장치 파일

    소켓은 네트워크 통신을 위한 추상화된 인터페이스입니다. 그리고 이것은 결국 NIC라는 하드웨어를 이용하게 됩니다. 소켓은 네트워크 통신 체계 및 장치에 대한 추상화된 인터페이스이고 파일 형식을 갖추고 있습니다.
    고로 소켓에 데이터를 전송(쓰기)하면 NIC를 통해 정보를 송신하게 됩니다.
  
 - 프로세스의 통신 과정은 어떻게 되나요?
  
 소켓 통신은 프로세스에서 데이터를 보내면 소켓을 지나고, TCP/IP를 거쳐 nic를 통해 네트워크를 지나 전송됩니다.

 - 단일 호스트에서 백엔드, 프론트엔드 통신 시나리오
    1. 백엔드 프론트엔드 프로그램을 실행 => 백엔드, 프론트엔드 프로세스 생성됨
    2. 프론트엔드가 백엔드로 요청을 보냄
    3. 소켓을 통해 데이터가 커널로 이동
    4. TCP/IP 통과
    5. 루프백 인터페이스를 통해 데이터가 동일한 시스템의 백엔드 프로세스로 전달됨
    6. 요청을 처리하고 응답
    7. 3~4번의 과정을 다시 수행
   
    > 루프백 인터페이스(lo0)는 데이터를 받았을 때 본래의 호스트로 돌려보내는 인터페이스입니다.
    루프백 인터페이스는 127.0.0.1을 사용하고 localhost라고도 불립니다.  
    루프백 인터페이스는 가상의 인터페이스로 실제 NIC를 통하지 않습니다.

    - 프로세스 통신은 소켓으로만 가능한가요?
  
    공유 메모리로도 IPC를 수행할 수 있고 TCP/IP 스택을 통하지 않으므로 훨씬 빠릅니다. 그러나 프로세스 동기화가 필요합니다.(세마포어, 뮤텍스 등)

## 웹소켓
 - 웹소켓이란?
   
   하나의 TCP 접속에 전이중 통신 채널을 제공하는 컴퓨터 통신 프로토콜입니다.
   > HTTP는 클라이언트 서버 모델이므로 반이중 통신입니다.

   웹소켓 프로토콜은 HTTP를 통해 초기 연결을 설정한 후, 연결이 성립되면 지속적인 소켓 연결로 전환됩니다. 이로 인해 데이터 전송이 보다 효율적이고 지연이 적어집니다.
   때문에 주로 실시간 웹 어플리케이션 기능을 구현하기 위해 사용합니다. (채팅, 주식 차트, 주식 가격 등)
   

------------------
- 소켓과 포트의 차이가 무엇인가요? 
  
    > 포트 : 하나의 디바이스에서 여러 네트워크 서비스를 허용하게 해주는 논리적인 장치입니다. 전송계층에서 사용되고, 숫자로 구분되기 위해 0~65536 번호를 갖고 있습니다.    
    
    소켓은 네트워크 통신의 엔드포인트입니다. 해당 소켓을 식별하기 위해 고유적인 값이 필요하고, 소켓의 고유성을 나타내기 위해서 IP주소 + 포트 번호를 조합하여 사용합니다. 그러므로 하나의 소켓에는 하나의 포트만 할당됩니다.

- 여러 소켓이 있다고 할 때, 그 소켓의 포트 번호는 모두 다른가요?   
  다중 접속 서버에서는 같을 수 있습니다.
  > 다중 접속 서버: 여러 클라이언트가 동시에 서버에 접속하여 서비스를 사용할 수 있도록 설계된 서버

  웹 어플리케이션 서버를 예시로 들면 포트 80에서 다수의 클라이언트 요청을 처리합니다. 이것은 서버가 각 클라이언트와의 연결마다 개별 소켓을 생성하고 있다는 것을 의미합니다.  
  서버는 클라이언트 연결되었을 때 연결 소켓을 생성합니다. 연결 소켓은 서버의 IP 주소, 서버 포트, 클라이언트 IP 주소, 클라이언트 포트로 고유하게 구별됩니다.
  - 리스닝 소켓 : listen() 함수가 호출되면 소켓은 리스닝 모드가 되며 소켓으로 오는 TCP 연결을 받기 시작합니다. 

  - 연결 소켓 : 연결에 성공하면 리스닝 소켓은 연결 소켓을 만들어 클라이언트와 통신을 전담하게 만듭니다. 연결 소켓은 클라이언트에서 요청이 올때까지 blocking 됩니다.

  리스닝 소켓은 포트 당 하나, 연결 소켓은 포트에 여러개 존재할 수 있습니다. 그러므로 소켓의 포트 번호는 같을 수 있습니다.
