# 1. DHCP
__등장 배경__
- TCP/IP 프로토콜을 사용하는 모든 호스트들은 ```IP 주소```, ```서브넷 마스크```가 할당되어야 정상적으로 네트워크와 연결이 가능함
- 다른 망과 통신하기 위해서는 디폴트게이트웨이 주소를 알아야하고, IP 주소 대신 도메인 이름을 사용해 통신하기위해 ```DNS 주소```도 알아야함
- 일반 사용자들이 해당 주소들을 입력하는 것이 쉽지 않으므로 호스트 설정 프로토콜이 등장하게 되었음

__개념__
- Dynamic Host Configuration Protocol (동적 호스트 구성 프로토콜)
- IP 네트워크에 사용되는 네트워크 프로토콜
- 호스트를 인터넷에 연결할때 호스트 구성정보를 자동으로 할당해주는 프로토콜
- UDP 기반 비연결형 서비스 프로토콜
- 네트워크 안에 컴퓨터에 자동으로 네임 서버 주소, IP 주소, 게이트웨이 주소를 할당해주는 것을 의미하고, 해당 클라이언트에게 ```일정 기간 임대를 하는 동적 주소 할당 프로토콜```
- DHCP 사용 없이는 수동으로 IP 주소를 할당해야 한다.
- DHCP 설정 없이 IP 주소를 수동으로 할당하면 비효율적이고 시간이 많이 소모되며 오류가 발생할 가능성이 높다.

# 2. DHCP의 구성요소
```DHCP 서버``` : 일반적으로 서버 또는 라우터. DHCP 서비스에서 실행되는 네트워크 장치입니다. IP 주소와 구성 관련 정보를 보유
일정한 범위의 IP 주소를 다른 클라이언트에 할당하여 자동으로 설정하게 해주는 역할을 한다.

```DHCP 클라이언트``` : 네트워크에 연결하고 DHCP 서버와 통신하는 컴퓨터 또는 전화와 같은 장치. 클라이언트들은 시스템이 시작하면 DHCP 서버에 자신의 시스템을 위한 IP 주소를 요청하고, DHCP로부터 IP 주소를 받으면 TCP/IP 설정은 초기화 되고 다른 호스트와 TCP/IP를 사용해서 통신을 할 수 있게 된다.

```DHCP 릴레이``` : DHCP 클라이언트와 서버 간의 요청을 관리. 일반적으로 릴레이는 조직이 대규모 또는 복잡한 네트워크를 처리할 때 사용

이외에 IP 주소 풀, 서브넷, 임대 및 DHCP 통신 프로토콜이 포함된다.

# 3. DHCP의 동작 과정
1. 장치는 네트워크에 연결 시 IP 주소를 요청한다.
2. 요청은 DHCP 서버로 전달되며, 서버는 주소를 할당한다.
3. 주소의 이용을 모니터링하며 장치의 연결이 해제되면 주소를 다시 가져온다.

- 해당 IP 주소는 다른 장치에 재할당할 수 있다.
- 장치는 IP 주소를 이용해 내부 및 공용 네트워크와 통신할 수 있다.

![](https://velog.velcdn.com/images/wxxhyeong/post/ffdf07b4-d3d7-4397-b5e2-cbf2dc52674e/image.png)
1. DHCP Discover
   클라이언트는 MAC 주소를 기반으로 네트워크에 DHCP 서버를 찾는 Discover 패킷을 브로드캐스팅한다.

2. DHCP Offer
   DHCP서버가 Discover 패킷을 받게 되면 서버는 할당할 IP주소 정보를 포함한 정보를 갖는 Offer 패킷을 브로드캐스팅한다.

3. DHCP Request
   클라이언트는 Offer를 받았다면 DHCP 서버의 존재 유무를 깨닫고, Request 패킷을 통해 하나의 DHCP서버를 선택하며 사용할 네트워크 정보를 요청하며 브로드캐스팅한다.
   ```클라이언트 -> 서버 ```

4. DHCP Ack
   서버는 Reqeust를 받으면 할당 가능한 IP를 풀에서 찾고, 네트워크 정보를 할당하는 Ack를 브로드캐스팅한다.

DHCP Ack를 수신한 클라이언트는 이제 IP 주소를 포함한 네트워크 정보를 획득(임대)했고, 이제 인터넷 사용이 가능하게 된다.

#### 갱신(Renewal)
임대기간이 끝나면 IP 주소를 반환하는데, 네트워크를 계속 사용해야 한다면 또 요청하고, 할당받기까지 불필요한 브로드캐스팅 패킷이 발생하므로 네트워크에 부담이 될 수 있다.

#### 반환(Release)
임대기간이 끝났거나, IP 주소를 더 사용하지 않는다면 IP 주소를 DHCP 주소풀에 반환하게 된다.

# 4. DHCP Relay Agent
- DHCP 서버에서 IP 주소를 할당받기 위해 DHCP 클라이언트와 DHCP 서버 간에 전송되는 패킷은 모두 브로드캐스트입니다. 브로드캐스트는 동일 네트워크에서만 전송되므로 DHCP를 사용하려면 각 네트워크마다 DHCP 서버가 있어야 합니다.
- DHCP 서버가 라우터 너머(다른 네트워크)에 있는 경우가 종종 있습니다.
  이런 경우 라우터에서 DHCP Relay Agent를 설정해 DHCP 요청을 라우터에서 유니캐스트로 변환하여 패킷을 전송하고, 서버는 다시 라우터에게 유니캐스트하고, 라우터는 브로드캐스트하여 할당합니다.

__DHCP 릴레이 에이전트__ 기능을 사용하면 DHCP 서버 한 대로 여러 네트워크 대역에서 IP 풀을 관리할 수 있습니다.
```DHCP 릴레이 에이전트```가 ```DHCP 클라이언트```와 ```DHCP 서버```가 서로 다른 대역에 있는 경우, DHCP 패킷을 중간에서 중계(Relay)하는 역할을 해준다.
